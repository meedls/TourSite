{% extends 'base.html' %}
{% load static %}

{% block title %}{{ hotel.name }} - Отель в {{ hotel.city.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/hotel_detail.css' %}">
{% endblock %}

{% block content %}
<div class="hotel-detail-container">
    <a href="{% url 'tours:tour_create' %}" class="back-button">
        <i class="fas fa-arrow-left"></i>
        <span>Назад</span>
    </a>
    
    <header class="hotel-header">
        <div class="hotel-content">
            <div class="hotel-image">
                {% if hotel.images.first %}
                    <img src="{{ hotel.images.first.image.url }}" alt="{{ hotel.name }}">
                {% else %}
                    <img src="{% static 'images/image 20.png' %}" alt="{{ hotel.name }}">
                {% endif %}
            </div>
            
            <div class="hotel-info">
                <h1 class="hotel-name">{{ hotel.name }}</h1>
                
                <div class="hotel-rating-line">
                    <div class="stars">
                        {% for i in "12345" %}
                            {% if forloop.counter <= hotel.rating %}
                                <i class="fas fa-star"></i>
                            {% else %}
                                <i class="far fa-star"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <span class="rating-number">{{ reviews.count }}</span>
                </div>
                
                <div class="hotel-description">
                    <p>{{ hotel.description|default:"Описание отеля будет добавлено" }}</p>
                </div>
                
                <div class="location-info">
                    <div class="location-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ hotel.address }}</span>
                    </div>
                    <div class="location-item">
                        <i class="fas fa-city"></i>
                        <span>{{ hotel.city.name }}</span>
                    </div>
                </div>
                
                <div class="booking-section">
                    <div class="price-info">
                        <span class="price">{{ hotel.price_min|floatformat:0 }} ₽ <span class="price-period">за ночь</span></span>
                    </div>
                    
                    <div class="booking-actions">
                        <a href="{% url 'hotels:hotel_book' hotel.pk %}" class="book-button" data-requires-auth="true">Забронировать</a>
                        <button class="favorite-button">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <section class="services-section">
        <h2 class="services-title">Услуги и удобства</h2>
        
        <div class="services-list">
            {% for service in hotel.services.all %}
            <div class="service-item">
                <div class="service-icon">
                    <div class="icon-circle">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                <div class="service-text">
                    <h3>{{ service.name }}</h3>
                    {% if service.description %}
                        <p>{{ service.description }}</p>
                    {% endif %}
                </div>
                <div class="service-action">
                    {% if service.price %}
                        <button class="details-button">{{ service.price|floatformat:0 }} ₽</button>
                    {% else %}
                        <button class="select-button open-minibar-modal">Выбрать</button>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="service-item">
                <div class="service-icon">
                    <div class="icon-circle">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                <div class="service-text">
                    <h3>Бесплатный мини-бар (безалкогольный)</h3>
                </div>
                <div class="service-action">
                    <button class="select-button open-minibar-modal">Выбрать</button>
                </div>
            </div>
            
            <div class="service-item">
                <div class="service-icon">
                    <div class="icon-circle">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                <div class="service-text">
                    <h3>Экскурсионное бюро с лицензированными гидами</h3>
                </div>
                <div class="service-action">
                </div>
            </div>
            
            <div class="service-item">
                <div class="service-icon">
                    <div class="icon-circle">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                <div class="service-text">
                    <h3>Трансфер на катере по рекам и каналам</h3>
                </div>
                <div class="service-action">
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    
    <section class="reviews-section">
        <div class="reviews-header">
            <div class="reviews-title-section">
                <h2 class="reviews-title">Отзывы гостей</h2>
                <div class="overall-rating">
                    <div class="stars">
                        {% for i in "12345" %}
                            {% if forloop.counter <= hotel.rating %}
                                <i class="fas fa-star"></i>
                            {% else %}
                                <i class="far fa-star"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="reviews-count">
                <span>{{ reviews.count }} отзыв{{ reviews.count|pluralize:"а,ов" }}</span>
            </div>
        </div>
        
        <div class="reviews-list">
            {% for review in reviews %}
            <div class="review-card">
                <div class="review-header">
                    <div class="reviewer-info">
                        <div class="profile-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="reviewer-details">
                            <h3 class="reviewer-name">{{ review.user.get_full_name|default:review.user.username }}</h3>
                            <div class="review-rating">
                                <div class="stars">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= review.rating %}
                                            <i class="fas fa-star"></i>
                                        {% else %}
                                            <i class="far fa-star"></i>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="review-date">{{ review.created_at|timesince }} назад</div>
                        </div>
                    </div>
                    {% if user.is_authenticated and user != review.user %}
                    <button class="subscribe-button">Подписаться</button>
                    {% endif %}
                </div>
                
                <div class="review-text">
                    <p>{{ review.text }}</p>
                </div>
                
                {% if user.is_authenticated %}
                <div class="review-actions">
                    <div class="like-dislike">
                        <a href="{% url 'hotels:review_like' review.pk %}" class="like-button">
                            <i class="far fa-thumbs-up"></i>
                            <span>{{ review.likes_count|default:0 }}</span>
                        </a>
                        <a href="{% url 'hotels:review_dislike' review.pk %}" class="dislike-button">
                            <i class="far fa-thumbs-down"></i>
                            <span>{{ review.dislikes_count|default:0 }}</span>
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
            {% empty %}
            <p>Пока нет отзывов. Будьте первым!</p>
            {% endfor %}
        </div>
    </section>
    
    <section class="important-info-section">
        <div class="important-info-fullwidth">
            <div class="important-info-content">
                <h2 class="important-info-title">Важно знать</h2>
                
                <div class="important-info-grid">
                    <div class="info-left">
                        <div class="info-item">
                            <h3 class="info-label">Заезд/выезд:</h3>
                            <p class="info-text">14:00 / 12:00</p>
                        </div>
                        
                        <div class="info-item">
                            <h3 class="info-label">Дети:</h3>
                            <p class="info-text">Бесплатно до 12 лет</p>
                        </div>
                        
                        <div class="info-item">
                            <h3 class="info-label">Питание:</h3>
                            <p class="info-text">Завтрак включён</p>
                        </div>
                        
                        <div class="info-item">
                            <h3 class="info-label">Город:</h3>
                            <p class="info-text">{{ hotel.city.name }}, {{ hotel.city.country }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Модальное окно для выбора мини-бара -->
<div class="modal-overlay minibar-modal" id="minibarModal" style="display:none;">
    <div class="modal-container">
        <div class="modal-header">
            <h2 class="modal-title">Выбор напитков и закусок</h2>
            <button class="modal-close" id="closeMinibarModal">&times;</button>
        </div>
        <div class="modal-content">
            <div class="selection-panel">
                <div class="panel-content">
                    <!-- Заголовок Выбор -->
                    <div class="choice-title">Выбор:</div>
                    
                    <!-- Вертикальное расположение разделов -->
                    <div class="vertical-sections">
                        <!-- Раздел напитков -->
                        <div class="selection-section vertical-section">
                            <div class="section-title">Напитки:</div>
                            
                            <div class="options-list">
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Кофе(зерновой/капсульный/растворимый)</span>
                                </label>
                                
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Чай(черный/зеленый/травяной)</span>
                                </label>
                                
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Молоко/Сливки</span>
                                </label>
                                
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Вода(газированная/негазированная)</span>
                                </label>
                                
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Соки(апельсиновый, яблочный)</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Раздел закусок -->
                        <div class="selection-section vertical-section">
                            <div class="section-title">Закуски:</div>
                            
                            <div class="options-list">
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Снеки (чипсы, орешки, сухарики)</span>
                                </label>
                                
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Сладости(шоколад, печенье, батончики)</span>
                                </label>
                                
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Фрукты(яблоки, бананы)</span>
                                </label>
                                
                                <label class="option-item">
                                    <input type="checkbox" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    <span class="option-text">Мини-сэндвичи</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-submit-button" id="saveMinibarSelection">Сохранить выбор</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Модальное окно мини-бара
        const selectButtons = document.querySelectorAll('.open-minibar-modal');
        const modal = document.getElementById('minibarModal');
        const closeModal = document.getElementById('closeMinibarModal');
        const modalOverlay = document.querySelector('.minibar-modal');
        const modalSubmitButton = document.getElementById('saveMinibarSelection');
        
        // Открытие модального окна
        selectButtons.forEach(button => {
            button.addEventListener('click', function() {
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            });
        });
        
        // Закрытие модального окна
        if (closeModal) {
            closeModal.addEventListener('click', function() {
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }
        
        if (modalOverlay) {
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }
        
        // Сохранение выбора
        if (modalSubmitButton) {
            modalSubmitButton.addEventListener('click', function() {
                const selectedCheckboxes = document.querySelectorAll('.minibar-modal .checkbox-input:checked');
                const selectedItems = [];
                
                selectedCheckboxes.forEach(checkbox => {
                    const optionText = checkbox.closest('.option-item').querySelector('.option-text').textContent;
                    selectedItems.push(optionText);
                });
                
                if (selectedItems.length > 0) {
                    // Здесь можно добавить отправку данных на сервер
                    console.log('Выбрано:', selectedItems.join(', '));
                }
                
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        }
        
        // Закрытие по Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal && modal.style.display === 'flex') {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });
    });
</script>
{% endblock %}
